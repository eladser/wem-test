using System.Windows;\nusing System.Windows.Controls;\nusing System.Windows.Media;\n\nnamespace WemLogViewer.Behaviors;\n\npublic static class TextBoxBehaviors\n{\n    public static readonly DependencyProperty WatermarkProperty =\n        DependencyProperty.RegisterAttached(\n            \"Watermark\",\n            typeof(string),\n            typeof(TextBoxBehaviors),\n            new PropertyMetadata(string.Empty, OnWatermarkChanged));\n\n    public static string GetWatermark(DependencyObject obj)\n    {\n        return (string)obj.GetValue(WatermarkProperty);\n    }\n\n    public static void SetWatermark(DependencyObject obj, string value)\n    {\n        obj.SetValue(WatermarkProperty, value);\n    }\n\n    private static void OnWatermarkChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)\n    {\n        if (d is TextBox textBox)\n        {\n            textBox.GotFocus -= TextBox_GotFocus;\n            textBox.LostFocus -= TextBox_LostFocus;\n            textBox.TextChanged -= TextBox_TextChanged;\n\n            if (!string.IsNullOrEmpty((string)e.NewValue))\n            {\n                textBox.GotFocus += TextBox_GotFocus;\n                textBox.LostFocus += TextBox_LostFocus;\n                textBox.TextChanged += TextBox_TextChanged;\n                \n                UpdateWatermark(textBox);\n            }\n        }\n    }\n\n    private static void TextBox_GotFocus(object sender, RoutedEventArgs e)\n    {\n        if (sender is TextBox textBox)\n        {\n            UpdateWatermark(textBox);\n        }\n    }\n\n    private static void TextBox_LostFocus(object sender, RoutedEventArgs e)\n    {\n        if (sender is TextBox textBox)\n        {\n            UpdateWatermark(textBox);\n        }\n    }\n\n    private static void TextBox_TextChanged(object sender, TextChangedEventArgs e)\n    {\n        if (sender is TextBox textBox)\n        {\n            UpdateWatermark(textBox);\n        }\n    }\n\n    private static void UpdateWatermark(TextBox textBox)\n    {\n        var watermark = GetWatermark(textBox);\n        \n        if (string.IsNullOrEmpty(textBox.Text) && !textBox.IsFocused)\n        {\n            textBox.Foreground = Brushes.Gray;\n            textBox.Text = watermark;\n        }\n        else if (textBox.Text == watermark && textBox.IsFocused)\n        {\n            textBox.Foreground = SystemColors.ControlTextBrush;\n            textBox.Text = string.Empty;\n        }\n        else if (!string.IsNullOrEmpty(textBox.Text) && textBox.Text != watermark)\n        {\n            textBox.Foreground = SystemColors.ControlTextBrush;\n        }\n    }\n}