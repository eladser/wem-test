<Window x:Class="WemLogViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WemLogViewer"
        Title="WEM Log Viewer" Height="900" Width="1400" MinHeight="600" MinWidth="1000"
        Icon="Resources/app.ico" WindowStartupLocation="CenterScreen">
    
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Open" Executed="OpenCommand_Executed"/>
        <CommandBinding Command="ApplicationCommands.Save" Executed="SaveCommand_Executed"/>
        <CommandBinding Command="ApplicationCommands.Find" Executed="FindCommand_Executed"/>
        <CommandBinding Command="local:CustomCommands.Refresh" Executed="RefreshCommand_Executed"/>
        <CommandBinding Command="local:CustomCommands.ClearFilter" Executed="ClearFilterCommand_Executed"/>
    </Window.CommandBindings>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Menu Bar -->
        <Menu Grid.Row="0">
            <MenuItem Header="_File">
                <MenuItem Header="_Open Log File..." Command="ApplicationCommands.Open" InputGestureText="Ctrl+O"/>
                <MenuItem Header="Open _Directory..." Click="OpenDirectory_Click"/>
                <MenuItem Header="Connect to _Database..." Click="ConnectDatabase_Click"/>
                <Separator/>
                <MenuItem Header="_Export Filtered Logs..." Command="ApplicationCommands.Save" InputGestureText="Ctrl+S"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Refresh" Command="local:CustomCommands.Refresh" InputGestureText="F5"/>
                <MenuItem Header="_Auto Refresh" IsCheckable="True" Name="AutoRefreshMenuItem" Click="AutoRefresh_Click"/>
                <Separator/>
                <MenuItem Header="_Statistics" Click="ShowStatistics_Click"/>
                <MenuItem Header="_Charts" Click="ShowCharts_Click"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Find" Command="ApplicationCommands.Find" InputGestureText="Ctrl+F"/>
                <MenuItem Header="_Clear Filters" Command="local:CustomCommands.ClearFilter"/>
                <Separator/>
                <MenuItem Header="_Settings" Click="Settings_Click"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Click="About_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Toolbar -->
        <ToolBar Grid.Row="1">
            <Button Command="ApplicationCommands.Open" Content="Open" ToolTip="Open log file (Ctrl+O)"/>
            <Button Command="local:CustomCommands.Refresh" Content="Refresh" ToolTip="Refresh logs (F5)"/>
            <Separator/>
            <Button Command="ApplicationCommands.Find" Content="Find" ToolTip="Find in logs (Ctrl+F)"/>
            <Button Command="local:CustomCommands.ClearFilter" Content="Clear Filters" ToolTip="Clear all filters"/>
            <Separator/>
            <Button Click="ShowStatistics_Click" Content="Statistics" ToolTip="Show log statistics"/>
            <Button Click="ShowCharts_Click" Content="Charts" ToolTip="Show log charts"/>
        </ToolBar>
        
        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*" MinWidth="400"/>
            </Grid.ColumnDefinitions>
            
            <!-- Filter Panel -->
            <Border Grid.Column="0" Background="#f5f5f5" BorderBrush="#ddd" BorderThickness="0,0,1,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="Filters" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                        
                        <!-- Log Level Filter -->
                        <Expander Header="Log Level" IsExpanded="True" Margin="0,0,0,10">
                            <StackPanel>
                                <CheckBox Name="TraceCheckBox" Content="Trace" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                                <CheckBox Name="DebugCheckBox" Content="Debug" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                                <CheckBox Name="InfoCheckBox" Content="Information" IsChecked="True" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                                <CheckBox Name="WarnCheckBox" Content="Warning" IsChecked="True" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                                <CheckBox Name="ErrorCheckBox" Content="Error" IsChecked="True" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                                <CheckBox Name="FatalCheckBox" Content="Fatal" IsChecked="True" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                            </StackPanel>
                        </Expander>
                        
                        <!-- Time Range Filter -->
                        <Expander Header="Time Range" IsExpanded="True" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="From:" Margin="5,5,5,2"/>
                                <DatePicker Name="FromDatePicker" Margin="5,0,5,5" SelectedDateChanged="Filter_Changed"/>
                                <TextBlock Text="To:" Margin="5,5,5,2"/>
                                <DatePicker Name="ToDatePicker" Margin="5,0,5,5" SelectedDateChanged="Filter_Changed"/>
                            </StackPanel>
                        </Expander>
                        
                        <!-- Search Filter -->
                        <Expander Header="Search" IsExpanded="True" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBox Name="SearchTextBox" Margin="5" Watermark="Search in messages..." TextChanged="Filter_Changed"/>
                                <CheckBox Name="RegexCheckBox" Content="Use Regex" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                                <CheckBox Name="CaseSensitiveCheckBox" Content="Case Sensitive" Margin="5" Checked="Filter_Changed" Unchecked="Filter_Changed"/>
                            </StackPanel>
                        </Expander>
                        
                        <!-- Component Filter -->
                        <Expander Header="Component" IsExpanded="False" Margin="0,0,0,10">
                            <StackPanel>
                                <ComboBox Name="ComponentComboBox" Margin="5" SelectionChanged="Filter_Changed" IsEditable="True"/>
                            </StackPanel>
                        </Expander>
                        
                        <!-- User Filter -->
                        <Expander Header="User" IsExpanded="False" Margin="0,0,0,10">
                            <StackPanel>
                                <ComboBox Name="UserComboBox" Margin="5" SelectionChanged="Filter_Changed" IsEditable="True"/>
                            </StackPanel>
                        </Expander>
                        
                        <!-- Quick Actions -->
                        <Expander Header="Quick Actions" IsExpanded="False" Margin="0,0,0,10">
                            <StackPanel>
                                <Button Content="Last Hour" Margin="5" Click="LastHour_Click"/>
                                <Button Content="Today" Margin="5" Click="Today_Click"/>
                                <Button Content="Errors Only" Margin="5" Click="ErrorsOnly_Click"/>
                                <Button Content="Clear All" Margin="5" Click="ClearFilters_Click"/>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
            <!-- Splitter -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Background="#ddd"/>
            
            <!-- Log Content -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="200" MinHeight="100"/>
                </Grid.RowDefinitions>
                
                <!-- Log List -->
                <DataGrid Name="LogDataGrid" Grid.Row="0" 
                         AutoGenerateColumns="False" 
                         IsReadOnly="True" 
                         SelectionMode="Single"
                         GridLinesVisibility="Horizontal"
                         HeadersVisibility="Column"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"
                         RowHeaderWidth="0"
                         SelectionChanged="LogDataGrid_SelectionChanged"
                         MouseDoubleClick="LogDataGrid_MouseDoubleClick">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Level" Binding="{Binding Level}" Width="80">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="Error">
                                            <Setter Property="Foreground" Value="Red"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Trigger>
                                        <Trigger Property="Text" Value="Fatal">
                                            <Setter Property="Foreground" Value="DarkRed"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Trigger>
                                        <Trigger Property="Text" Value="Warning">
                                            <Setter Property="Foreground" Value="Orange"/>
                                        </Trigger>
                                        <Trigger Property="Text" Value="Information">
                                            <Setter Property="Foreground" Value="Blue"/>
                                        </Trigger>
                                        <Trigger Property="Text" Value="Debug">
                                            <Setter Property="Foreground" Value="Gray"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp, StringFormat=yyyy-MM-dd HH:mm:ss.fff}" Width="150"/>
                        <DataGridTextColumn Header="Component" Binding="{Binding Component}" Width="120"/>
                        <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Details Splitter -->
                <GridSplitter Grid.Row="1" HorizontalAlignment="Stretch" Height="5" Background="#ddd"/>
                
                <!-- Log Details Panel -->
                <TabControl Grid.Row="2" Name="DetailsTabControl">
                    <TabItem Header="Message Details">
                        <ScrollViewer>
                            <TextBox Name="MessageDetailsTextBox" 
                                   IsReadOnly="True" 
                                   TextWrapping="Wrap" 
                                   FontFamily="Consolas" 
                                   FontSize="12" 
                                   Background="#f9f9f9"
                                   Margin="5"/>
                        </ScrollViewer>
                    </TabItem>
                    <TabItem Header="Context">
                        <ScrollViewer>
                            <TextBox Name="ContextTextBox" 
                                   IsReadOnly="True" 
                                   TextWrapping="Wrap" 
                                   FontFamily="Consolas" 
                                   FontSize="12" 
                                   Background="#f9f9f9"
                                   Margin="5"/>
                        </ScrollViewer>
                    </TabItem>
                    <TabItem Header="Stack Trace">
                        <ScrollViewer>
                            <TextBox Name="StackTraceTextBox" 
                                   IsReadOnly="True" 
                                   TextWrapping="Wrap" 
                                   FontFamily="Consolas" 
                                   FontSize="10" 
                                   Background="#f9f9f9"
                                   Margin="5"/>
                        </ScrollViewer>
                    </TabItem>
                    <TabItem Header="Raw Log">
                        <ScrollViewer>
                            <TextBox Name="RawLogTextBox" 
                                   IsReadOnly="True" 
                                   TextWrapping="Wrap" 
                                   FontFamily="Consolas" 
                                   FontSize="10" 
                                   Background="#f9f9f9"
                                   Margin="5"/>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Name="StatusTextBlock" Text="Ready"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Name="LogCountTextBlock" Text="0 logs"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Name="FilteredCountTextBlock" Text="0 filtered"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar Name="LoadingProgressBar" Width="200" Height="16" Visibility="Collapsed"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>